# Shopify Integration Steps for Product Configurator

## Overview
This guide shows how to integrate your product configurations from the ZMF configurator tool into your Shopify store.

## Step 1: Export Your Configuration
1. Go to `/product-configurator` in your dashboard
2. Create and configure your headphone models
3. Click "Export Configuration" to download the JSON file

## Step 2: Create Products in Shopify Admin

### For Variant-Based Options (max 3):
1. In Shopify Admin, create a new product
2. Add your variant options:
   ```
   Option 1: Wood Type
   Values: Walnut, Cherry, Oak
   
   Option 2: Cable Type  
   Values: Silver, Copper, Gold
   ```
3. Shopify will auto-generate all variant combinations
4. Set individual prices for each variant if needed

### For Line Item Properties:
These are added via custom code in your theme (see Step 3)

## Step 3: Add Custom Code to Your Theme

### A. Edit Your Product Template
Location: `sections/product-template.liquid` (or similar)

```liquid
<!-- Add this inside your product form -->
<form action="/cart/add" method="post" enctype="multipart/form-data">
  
  <!-- Standard variant selector (auto-generated by Shopify) -->
  <select name="id" id="productSelect">
    {% for variant in product.variants %}
      <option value="{{ variant.id }}">{{ variant.title }}</option>
    {% endfor %}
  </select>

  <!-- Custom Line Item Properties -->
  {% comment %} Pad Type Option {% endcomment %}
  <div class="product-option">
    <label for="pad-type">Pad Type</label>
    <select name="properties[Pad Type]" id="pad-type" required>
      <option value="">Select Pad Type</option>
      <option value="Lambskin">Lambskin</option>
      <option value="Suede">Suede (+$25)</option>
      <option value="Protein">Protein</option>
      <option value="Hybrid">Hybrid (+$50)</option>
    </select>
  </div>

  {% comment %} Engraving Option {% endcomment %}
  <div class="product-option">
    <label for="engraving">Custom Engraving</label>
    <input type="text" name="properties[Engraving]" id="engraving" maxlength="20">
    <small>+$35 for custom engraving</small>
  </div>

  {% comment %} Hidden price adjustment (optional) {% endcomment %}
  <input type="hidden" name="properties[_price_adjustment]" value="0" id="price-adjustment">

  <button type="submit" name="add" class="btn product-form__cart-submit">
    Add to Cart
  </button>
</form>
```

### B. Add JavaScript for Dynamic Pricing
Add to `assets/product-customizer.js`:

```javascript
document.addEventListener('DOMContentLoaded', function() {
  // Configuration from your exported JSON
  const config = {
    basePrice: 2999.00,
    options: {
      'Pad Type': {
        'Lambskin': 0,
        'Suede': 25,
        'Protein': 0,
        'Hybrid': 50
      },
      'Engraving': 35 // flat fee if filled
    }
  };

  // Calculate total price
  function updatePrice() {
    let totalAdjustment = 0;
    
    // Get selected variant price
    const variantSelect = document.getElementById('productSelect');
    const selectedVariant = variantSelect.options[variantSelect.selectedIndex];
    
    // Add pad type adjustment
    const padType = document.getElementById('pad-type').value;
    if (padType && config.options['Pad Type'][padType]) {
      totalAdjustment += config.options['Pad Type'][padType];
    }
    
    // Add engraving fee
    const engraving = document.getElementById('engraving').value;
    if (engraving.trim()) {
      totalAdjustment += config.options['Engraving'];
    }
    
    // Update hidden field for backend processing
    document.getElementById('price-adjustment').value = totalAdjustment;
    
    // Update displayed price (visual only)
    const displayPrice = document.querySelector('.product-price');
    if (displayPrice) {
      const basePrice = parseFloat(selectedVariant.dataset.price) / 100;
      displayPrice.textContent = `$${(basePrice + totalAdjustment).toFixed(2)}`;
    }
  }

  // Attach listeners
  document.getElementById('pad-type').addEventListener('change', updatePrice);
  document.getElementById('engraving').addEventListener('input', updatePrice);
  document.getElementById('productSelect').addEventListener('change', updatePrice);
});
```

### C. Include the JavaScript
In your product template:
```liquid
{{ 'product-customizer.js' | asset_url | script_tag }}
```

## Step 4: Handle Price Adjustments

### Option 1: Shopify Scripts (Plus/Advanced/Shopify Plus)
Create a Line Item script:
```ruby
Input.cart.line_items.each do |line_item|
  if line_item.properties['_price_adjustment']
    adjustment = Money.new(cents: line_item.properties['_price_adjustment'].to_i * 100)
    line_item.change_line_price(line_item.line_price + adjustment, message: "Custom options")
  end
end
```

### Option 2: Draft Orders API
Use a webhook to intercept orders and create draft orders with adjusted prices.

### Option 3: Third-Party Apps
- **Infinite Options** by ShopPad
- **Product Customizer** by King Product Options
- **Bold Product Options**

## Step 5: Display in Cart/Checkout

Edit `sections/cart-template.liquid`:
```liquid
{% for item in cart.items %}
  <div class="cart-item">
    <h3>{{ item.product.title }}</h3>
    
    <!-- Show variant title -->
    {% unless item.variant.title == 'Default Title' %}
      <p>{{ item.variant.title }}</p>
    {% endunless %}
    
    <!-- Show custom properties -->
    {% for property in item.properties %}
      {% unless property.first contains '_' %}
        <p><small>{{ property.first }}: {{ property.last }}</small></p>
      {% endunless %}
    {% endfor %}
    
    <p>{{ item.final_line_price | money }}</p>
  </div>
{% endfor %}
```

## Step 6: Test Your Integration

1. **Test the flow:**
   - Select variants
   - Choose custom options
   - Add to cart
   - Verify properties appear in cart
   - Complete test checkout

2. **Check order details:**
   - Line item properties should appear in order
   - Verify in Shopify Admin > Orders

## API Integration Option

For a more robust solution, create an app that:

1. **Syncs configurations:**
```javascript
// POST to your API when product is saved
fetch('https://your-api.com/sync-product', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Shopify-Shop': shop.domain
  },
  body: JSON.stringify({
    productId: product.id,
    configuration: exportedConfig
  })
})
```

2. **Serves configuration to storefront:**
```javascript
// In theme, fetch config
fetch(`https://your-api.com/product-config/${productId}`)
  .then(res => res.json())
  .then(config => {
    // Build option selectors dynamically
    buildProductOptions(config);
  });
```

## Common Issues & Solutions

### Properties not showing in checkout
- Some checkout templates need customization
- Contact Shopify Plus support for checkout.liquid access

### Price not updating
- Shopify Scripts only work on Plus plans
- Consider using Draft Orders API instead

### Too many variants
- Use line item properties for options beyond 3
- Consider product bundles for common configurations

## Next Steps

1. Start with a test product
2. Implement basic line item properties
3. Add JavaScript enhancements
4. Test thoroughly
5. Roll out to all products

For questions, refer to:
- [Shopify Line Item Properties Docs](https://shopify.dev/docs/storefronts/themes/architecture/templates/cart#line-item-properties)
- [AJAX API Reference](https://shopify.dev/docs/storefronts/themes/ajax-api)
- Your exported configuration from `/product-configurator`